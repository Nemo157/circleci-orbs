parameters:
  toolchain:
    type: string

  minimal-versions:
    type: boolean
    default: false

  locked:
    type: boolean
    default: false

steps:
- when:
    condition: << parameters.locked >>
    steps:
    - when:
        condition: << parameters.minimal-versions >>
        steps:
        - run:
            command: "echo 'ERROR: locked and minimal-versions'"
        - run:
            command: false
- unless:
    condition: << parameters.locked >>
    steps:
    - cargo:
        toolchain: << parameters.toolchain >>
        command: >
          update
          <<# parameters.minimal-versions >>
            -Z minimal-versions
          <</ parameters.minimal-versions >>
